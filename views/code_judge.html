<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Judge</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2> Code and Judge</h2>
    <a href="/problem_list"><button>&lt;-back to problem_list</button></a>
    <button>fast test x</button>
    <a href="/judge_list"><button>Judge list</button></a>
    <button>run x</button>
    <div class="problem_code">
        <div class="left-problem">
            <h4>題目描述</h4>
            <script>
                // 取得 URL 中的參數
                const urlParams = new URLSearchParams(window.location.search);
                const q_id = urlParams.get('q_id');
            
                async function fetchProblem() {
                    const res = await fetch(`/api/problem/${q_id}`);
                    const data = await res.json();

                    document.getElementById('info').textContent = data.info;
                    document.getElementById('input_info').textContent = data.Input_info;
                    document.getElementById('output_info').textContent = data.Output_info;
                    console.log('q_id:', q_id); // 如果是 null 就代表網址沒帶參數
                    //document.getElementById('description').textContent = data.description;
                }
            
                fetchProblem();
            </script>
            <table>
                <tr>
                    <th>內容</th>
                </tr>
                <tr>
                    <td id="info">
                    </td>
                </tr>
            </table>
            <br>
            <table>
                <tr>
                    <th>輸入</th>
                    <th>輸出</th>
                </tr>
                <tr>
                    <td id="input_info">
                    </td>
                    <td id="output_info">
                    </td>
                </tr>
            </table>
            <br>
            <table>
                <tr>
                    <td>範例輸入</td>
                    <td>範例輸出</td>
                </tr>
                <tr>
                    <td>world</td>
                    <td>hello, world</td>
                </tr>
                <tr>
                    <td>c++</td>
                    <td>hello, c++</td>
                </tr>
                <tr>
                    <td>Taiwan</td>
                    <td>hello, Taiwan</td>
                </tr>
            </table>
        </div>
        <div class="right-code">
            <button onclick="submitCode()">Submit</button>
            <textarea id="codeInput" placeholder="在這裡輸入程式碼..."></textarea>
            <pre id="output"></pre>
        </div>
    </div>
    <script>
        async function submitCode() {
            const code = document.getElementById("codeInput").value;
            const response = await fetch("/submit", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ code })
            });

            const result = await response.json();
            const outputElement = document.getElementById("output");
            outputElement.innerText = "";
            outputElement.className = "";//清除背景顏色


            if (result.error) {
                outputElement.innerText = result.error;
                return;
            }
            let allPassed = true;
            result.results.forEach(({ input, expected, output, error }) => {
                outputElement.innerText += `輸入: ${input}\n`;
                outputElement.innerText += `正確輸出： ${expected}\n`;
                outputElement.innerText += `實際輸出： ${output || "執行錯誤"}\n`;

                if (error || output!== expected){
                    allPassed = false;
                }

                if (error) outputElement.innerText += `ERROR: ${error}\n`;
                outputElement.innerText += "-------------------------\n";

            });

            if (allPassed) {
                outputElement.innerText += "\nJudge 通過 ✅";
                outputElement.classList.add("pass");
            } else {
                outputElement.innerText += "\nJudge 沒通過 ❌";
                outputElement.classList.add("fail");
            }
        }
    </script>
</body>
</html>